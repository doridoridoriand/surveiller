# タスク: 構造化ログ出力のプロパティテスト（プロパティ17）

## タスク概要
- **プロパティ17**: 構造化ログ出力
- **検証対象**: 要件 6.1, 6.2, 6.3, 6.4, 6.5
- **説明**: システムイベント（ping 結果、設定読み込み、エラー）に対して、システムは適切な構造化ログを出力し、ログレベル設定に従ってフィルタリングする

## 関連要件

### 要件 6.1
- WHEN システムが動作する THEN システムは重要なイベントを構造化ログとして出力する

### 要件 6.2
- WHEN ping の成功/失敗が発生する THEN システムはターゲット名、結果、RTT をログに記録する

### 要件 6.3
- WHEN 設定ファイルの読み込みが行われる THEN システムは読み込み結果をログに記録する

### 要件 6.4
- WHEN エラーが発生する THEN システムは詳細なエラー情報をログに出力する

### 要件 6.5
- WHEN ログレベルが設定されている THEN システムは指定されたレベル以上のログのみを出力する

## 現在の実装状況

### ログ出力の現状
現在のコードベースでは、構造化ログは実装されていない可能性があります。以下の場所でログ出力が行われています：

1. **main.go**
   - `fmt.Fprintf(os.Stderr, "failed to load config: %v\n", err)` (74行目)
   - `fmt.Fprintf(os.Stderr, "failed to reload config: %v\n", err)` (113行目)
   - `fmt.Fprintf(os.Stderr, "metrics error: %v\n", err)` (139行目)
   - `fmt.Fprintf(os.Stderr, "scheduler error: %v\n", err)` (148行目)
   - `fmt.Fprintf(os.Stderr, "ui error: %v\n", err)` (163行目)

2. **runTextReporter** (main.go 228-259行目)
   - テキスト形式でのログ出力（JSON形式ではない）

## 実装方針

### オプション1: 既存のログ出力を検証
- 現在の`fmt.Fprintf`によるログ出力を検証
- 構造化ログが未実装の場合、テストは将来の実装を前提とした設計

### オプション2: 構造化ログの実装とテスト
- 構造化ログ機能を実装してからテスト
- JSON形式のログ出力を実装
- ログレベル制御機能を実装

## テスト実装方針

### プロパティテストの要件
- **使用ライブラリ**: `gopter`
- **最低反復回数**: 100回
- **タグ形式**: `**Feature: surveiller, Property 17: 構造化ログ出力**`

### テストケース
1. **ping結果のログ出力**
   - 成功時のログ（ターゲット名、RTT）
   - 失敗時のログ（ターゲット名、エラー情報）

2. **設定読み込みのログ出力**
   - 成功時のログ
   - 失敗時のログ

3. **エラーログの出力**
   - 各種エラーケースでのログ出力

4. **ログレベルのフィルタリング**
   - ログレベル設定に従ったフィルタリング

## 実装場所
- ファイル: `main_prop_test.go` または `main_test.go`
- 関数名: `TestPropertyStructuredLogging`

## 注意事項
- 構造化ログが未実装の場合、テストの実装方法を検討する必要がある
- ログ出力の検証には、stdout/stderrのキャプチャが必要
- JSON形式のログを検証する場合は、JSONパースが必要

## 参考実装
- `internal/state/store_prop_test.go` - プロパティテストの実装例
- `internal/ui/ui_prop_test.go` - プロパティテストの実装例
