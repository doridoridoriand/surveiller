# 実装プラン

- [ ] 1. プロジェクト構造とコアインターフェースの設定
  - Go モジュールの初期化と基本ディレクトリ構造の作成
  - 主要なインターフェース（Pinger, StateStore, Scheduler, ConfigParser）の定義
  - テストフレームワーク（gopter）の設定
  - _要件: 1.1, 2.1, 4.1_

- [x] 2. 設定ファイルパーサーの実装
- [x] 2.1 基本的な設定ファイル解析機能の実装
  - TargetConfig と GlobalOptions 構造体の実装
  - deadman.conf ファイルの基本解析ロジック
  - _要件: 1.1, 1.2_

- [x]* 2.2 設定ファイル解析の正確性プロパティテスト
  - **プロパティ 1: 設定ファイル解析の正確性**
  - **検証対象: 要件 1.1, 1.2**

- [x] 2.3 グローバル設定ディレクティブ処理の実装
  - `# deadman-go:` 行の解析機能
  - key=value ペアの GlobalOptions への反映
  - _要件: 1.3_

- [x]* 2.4 グローバル設定ディレクティブ処理のプロパティテスト
  - **プロパティ 2: グローバル設定ディレクティブの処理**
  - **検証対象: 要件 1.3**

- [x] 2.5 コメント行処理とエラーハンドリングの実装
  - 通常のコメント行の無視機能
  - 構文エラーの検出と適切なエラーメッセージ
  - _要件: 1.4, 1.5_

- [x]* 2.6 コメント行とエラーハンドリングのプロパティテスト
  - **プロパティ 3: コメント行の無視**
  - **プロパティ 4: 設定ファイル構文エラー検出**
  - **検証対象: 要件 1.4, 1.5**

- [x] 3. CLI オプション処理の実装
- [x] 3.1 CLI フラグ定義と解析の実装
  - flag パッケージを使用した CLI オプション定義
  - CLIOverrides 構造体の実装
  - _要件: 8.1, 8.2, 8.3, 8.4_

- [x]* 3.2 CLI 設定優先度のプロパティテスト
  - **プロパティ 18: CLI 設定優先度**
  - **検証対象: 要件 8.1, 8.2, 8.3, 8.4**

- [x] 3.3 CLI エラーハンドリングの実装
  - 無効なオプションに対するヘルプメッセージ表示
  - バージョン情報の表示
  - _要件: 8.5_

- [ ] 4. ICMP Ping エンジンの実装
- [ ] 4.1 Pinger インターフェースと ICMP 実装
  - golang.org/x/net/icmp を使用した ICMP ping 実装
  - PingResult 構造体とエラーハンドリング
  - _要件: 2.1, 2.5_

- [ ] 4.2 タイムアウト処理の実装
  - context.WithTimeout を使用したタイムアウト制御
  - タイムアウト時の失敗処理
  - _要件: 2.5_

- [ ]* 4.3 タイムアウト処理のプロパティテスト
  - **プロパティ 6: タイムアウト処理**
  - **検証対象: 要件 2.5**

- [ ] 5. 状態管理システムの実装
- [ ] 5.1 StateStore インターフェースと実装
  - TargetStatus 構造体と状態遷移ロジック
  - スレッドセーフな状態更新機能
  - _要件: 2.2, 2.3, 2.4_

- [ ]* 5.2 ping 結果状態更新のプロパティテスト
  - **プロパティ 5: ping 結果の状態更新**
  - **検証対象: 要件 2.2, 2.3, 2.4**

- [ ] 5.3 RTT 履歴管理の実装
  - リングバッファによる RTT 履歴保持
  - 履歴サイズの制限と古いデータの削除
  - _要件: 5.5_

- [ ]* 5.4 履歴保持のプロパティテスト
  - **プロパティ 16: 履歴保持**
  - **検証対象: 要件 5.5**

- [ ] 5.5 動的設定更新機能の実装
  - ターゲット追加・削除時の状態管理
  - 既存ターゲットの履歴保持
  - _要件: 5.2, 5.3_

- [ ]* 5.6 動的設定更新のプロパティテスト
  - **プロパティ 14: 動的設定更新**
  - **検証対象: 要件 5.2, 5.3**

- [ ] 6. チェックポイント - 基本機能のテスト確認
  - 全てのテストが通ることを確認し、問題があれば質問する

- [x] 7. スケジューラーの実装
- [x] 7.1 基本スケジューラーの実装
  - ターゲットごとの goroutine 管理
  - 監視間隔の制御
  - _要件: 4.1, 4.3_

- [x]* 7.2 並列監視独立性のプロパティテスト
  - **プロパティ 10: 並列監視の独立性**
  - **検証対象: 要件 4.1**

- [x]* 7.3 監視間隔遵守のプロパティテスト
  - **プロパティ 12: 監視間隔の遵守**
  - **検証対象: 要件 4.3**

- [x] 7.4 並列度制御の実装
  - セマフォによる同時実行数制限
  - ping ストーム防止機能
  - _要件: 4.2_

- [x]* 7.5 並列度制御のプロパティテスト
  - **プロパティ 11: 並列度制御**
  - **検証対象: 要件 4.2**

- [x] 7.6 終了処理の実装
  - context.Context による適切な終了処理
  - 全 goroutine の適切な終了
  - _要件: 4.4_

- [x]* 7.7 適切な終了処理のプロパティテスト
  - **プロパティ 13: 適切な終了処理**
  - **検証対象: 要件 4.4**

- [ ] 8. TUI システムの実装
- [ ] 8.1 基本 TUI 構造の実装
  - bubbletea を使用した基本 TUI フレームワーク
  - ターゲット情報の表示レイアウト
  - _要件: 3.1_

- [ ] 8.2 グループ表示機能の実装
  - グループごとの区切り線表示
  - グループ名の表示
  - _要件: 3.2_

- [ ]* 8.3 TUI グループ表示のプロパティテスト
  - **プロパティ 7: TUI グループ表示**
  - **検証対象: 要件 3.2**

- [ ] 8.4 RTT バーグラフ表示の実装
  - RTT 値のバーグラフ描画
  - スケール設定による表示調整
  - _要件: 3.3_

- [ ]* 8.5 TUI RTT バーグラフ表示のプロパティテスト
  - **プロパティ 8: TUI RTT バーグラフ表示**
  - **検証対象: 要件 3.3**

- [ ] 8.6 リアルタイム更新機能の実装
  - 状態変化の即座な TUI 反映
  - キーボード入力処理（'q' キーでの終了）
  - _要件: 3.4, 3.5_

- [ ]* 8.7 TUI 状態更新のプロパティテスト
  - **プロパティ 9: TUI 状態更新の即時反映**
  - **検証対象: 要件 3.4**

- [ ] 9. ログシステムの実装
- [ ] 9.1 構造化ログの実装
  - JSON 形式での構造化ログ出力
  - ログレベル制御機能
  - _要件: 6.1, 6.5_

- [ ] 9.2 イベントログ記録の実装
  - ping 結果のログ記録
  - 設定読み込みのログ記録
  - エラー情報のログ記録
  - _要件: 6.2, 6.3, 6.4_

- [ ]* 9.3 構造化ログ出力のプロパティテスト
  - **プロパティ 17: 構造化ログ出力**
  - **検証対象: 要件 6.1, 6.2, 6.3, 6.4, 6.5**

- [ ] 10. シグナルハンドリングの実装
- [ ] 10.1 SIGHUP による設定リロード
  - シグナルハンドラーの実装
  - 設定ファイルの再読み込み機能
  - _要件: 5.1_

- [ ] 10.2 設定リロードエラー処理の実装
  - 無効な設定ファイルでのエラーハンドリング
  - 既存設定の維持機能
  - _要件: 5.4_

- [ ]* 10.3 設定リロードエラー処理のプロパティテスト
  - **プロパティ 15: 設定リロードエラー処理**
  - **検証対象: 要件 5.4**

- [ ] 11. メイン関数とアプリケーション統合
- [ ] 11.1 main.go の実装
  - 全コンポーネントの初期化と統合
  - アプリケーションライフサイクルの管理
  - _要件: 全体統合_

- [ ] 11.2 エラーハンドリングの統合
  - ICMP 権限不足時のエラー処理
  - 適切なエラーメッセージとヘルプ表示
  - _要件: 7.5_

- [ ] 12. 最終チェックポイント - 全機能テスト
  - 全てのテストが通ることを確認し、問題があれば質問する
